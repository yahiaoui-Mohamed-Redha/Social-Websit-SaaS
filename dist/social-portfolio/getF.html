<div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-xl">
    <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</h2>
    <input type="text" id="urlInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· TikTok Ø£Ùˆ Instagram Ø£Ùˆ YouTube"
           class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
    <button onclick="getFollowers()"
            class="w-full mt-4 bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700 transition duration-200">
      Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†
    </button>
    <div id="result" class="mt-6 text-center text-lg text-green-600 font-medium">ğŸ” ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø·...</div>
</div>

<script>
    // Replace with your actual YouTube API key
    const YOUTUBE_API_KEY = "AIzaSyAoYCQq3zVkJydrL0lNt1Jfe6imJXLvd04"; // Replace with your key
    
    async function getFollowers() {
      const url = document.getElementById("urlInput").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

      if (!url) {
        resultDiv.innerText = "âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø·.";
        return;
      }

      try {
        // YouTube handling
        if (url.includes("youtube.com") || url.includes("youtu.be")) {
          if (!YOUTUBE_API_KEY || YOUTUBE_API_KEY.includes("AIzaSyAoYCQq3zVkJydrL0lNt1Jfe6imJXLvd04")) {
            resultDiv.innerText = "âŒ ÙŠÙ„Ø²Ù… Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ YouTube API ØµØ§Ù„Ø­.";
            return;
          }
          
          const channelId = await extractYouTubeChannelId(url);
          if (!channelId) {
            resultDiv.innerText = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø© Ù…Ø¨Ø§Ø´Ø±Ø©.";
            return;
          }

          const apiUrl = `https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${YOUTUBE_API_KEY}`;
          const response = await fetch(apiUrl);
          
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error?.message || "YouTube API error");
          }
          
          const data = await response.json();

          if (data.items?.length > 0) {
            const count = data.items[0].statistics.subscriberCount;
            resultDiv.innerText = `ğŸ“º Ù…ØªØ§Ø¨Ø¹ÙŠÙ† YouTube: ${Number(count).toLocaleString()}`;
          } else {
            resultDiv.innerText = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·.";
          }
          return;
        }

        // Instagram handling
        if (url.includes("instagram.com")) {
          // Try with different proxies
          const proxies = [
            "https://api.allorigins.win/get?url=",
            "https://cors-anywhere.herokuapp.com/",
            "https://thingproxy.freeboard.io/fetch/"
          ];
          
          let lastError = null;
          
          for (const proxy of proxies) {
            try {
              const response = await fetch(proxy + encodeURIComponent(url), {
                headers: {
                  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                }
              });
              
              if (!response.ok) continue;
              
              const data = await response.json();
              const html = data.contents || data;
              
              // New Instagram patterns
              const patterns = [
                /"edge_followed_by":\{"count":(\d+)\}/,
                /"followers":\s*(\d+)/,
                /"userInteractionCount":"([\d,]+)"/,
                /([\d,]+)\s+Followers/
              ];
              
              for (const pattern of patterns) {
                const match = html.match(pattern);
                if (match) {
                  const count = match[1].replace(/,/g, '');
                  resultDiv.innerText = `ğŸ“¸ Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Instagram: ${Number(count).toLocaleString()}`;
                  return;
                }
              }
            } catch (e) {
              lastError = e;
              continue;
            }
          }
          
          throw new Error(lastError || "Instagram: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†");
        }

        // TikTok handling
        if (url.includes("tiktok.com")) {
          const proxy = "https://api.allorigins.win/get?url=";
          const response = await fetch(proxy + encodeURIComponent(url));
          
          if (!response.ok) {
            throw new Error("TikTok: ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
          }
          
          const data = await response.json();
          const patterns = [
            /"followerCount":(\d+)/,
            /"followers":([0-9]+)/,
            /"followers":\s*"([\d,]+)"/
          ];
          
          for (const pattern of patterns) {
            const match = data.contents.match(pattern);
            if (match) {
              const count = match[1].replace(/,/g, '');
              resultDiv.innerText = `ğŸµ Ù…ØªØ§Ø¨Ø¹ÙŠÙ† TikTok: ${Number(count).toLocaleString()}`;
              return;
            }
          }
          
          throw new Error("TikTok: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†");
        }

        resultDiv.innerText = "âŒ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø§Ø³ØªØ®Ø¯Ù… Ø±ÙˆØ§Ø¨Ø· YouTube Ø£Ùˆ Instagram Ø£Ùˆ TikTok ÙÙ‚Ø·.";
      } catch (error) {
        console.error("Error:", error);
        resultDiv.innerText = `âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message || "Ø¬Ø±Ø¨ Ø±Ø§Ø¨Ø·Ù‹Ø§ Ø¢Ø®Ø± Ø£Ùˆ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§"}`;
      }
    }

    async function extractYouTubeChannelId(url) {
      try {
        // Handle channel URLs
        if (url.includes("/channel/")) {
          return url.split("/channel/")[1].split(/[/?#&]/)[0];
        }
        
        // Handle @handle URLs (new style)
        if (url.includes("youtube.com/@")) {
          const handle = url.split("youtube.com/@")[1].split(/[/?#&]/)[0];
          // Need to convert handle to channel ID
          try {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${handle}&type=channel&key=${YOUTUBE_API_KEY}`);
            const data = await response.json();
            return data.items?.[0]?.id?.channelId || null;
          } catch {
            return null;
          }
        }
        
        // Handle video URLs
        if (url.includes("/watch")) {
          const videoId = url.split("v=")[1].split(/[&?#]/)[0];
          try {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${YOUTUBE_API_KEY}`);
            const data = await response.json();
            return data.items?.[0]?.snippet?.channelId || null;
          } catch {
            return null;
          }
        }
        
        return null;
      } catch (e) {
        console.error("Channel ID extraction error:", e);
        return null;
      }
    }
</script>